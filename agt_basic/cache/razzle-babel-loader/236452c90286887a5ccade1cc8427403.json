{"ast":null,"code":"import bcrypt from 'bcryptjs';\nimport { v4 as uuidv4 } from 'uuid';\nexport const clipImage = (w, h, imgsrc, sig) => {\n  const cnv = document.createElement('canvas');\n\n  if (cnv !== null) {\n    cnv.width = w;\n    cnv.height = h;\n    const CNVASPECT = cnv.width / cnv.height;\n    const ctx = cnv.getContext('2d');\n    const img = new Image();\n    img.src = imgsrc;\n    return new Promise((resolve, reject) => {\n      img.onload = () => {\n        let sx = 0;\n        let sy = 0;\n        let dx = 0;\n        let dy = 0;\n        let iw = img.width;\n        let ih = img.height;\n        let cw = 0;\n        let ch = 0;\n        const IMGASPECT = iw / ih;\n\n        if (IMGASPECT >= CNVASPECT) {\n          //  console.log('Clipping sides : ' + IMGASPECT);\n          ch = cnv.height;\n          cw = IMGASPECT * ch;\n          dx = (cw - cnv.width) * 0.5;\n        } else {\n          //     console.log('Clipping height : ' + IMGASPECT);\n          cw = cnv.width;\n          ch = cw / IMGASPECT;\n          dy = (ch - cnv.height) * 0.5;\n        } //  ctx.scale(2.0,2.0);\n\n\n        ctx.drawImage(img, sx, sy, iw, ih, -dx, -dy, cw, ch);\n        resolve(cnv.toDataURL('image/jpeg', 1.0));\n      };\n\n      img.onerror = () => {\n        if (sig.signal) {\n          sig.signal.addEventListener('abort', event => {\n            return reject(event);\n          });\n        }\n\n        return reject(new Error('I am an error'));\n      };\n    });\n  }\n};\nexport const padNum = (pad, number, numlength) => (number + '').length < numlength ? Array(pad).fill(0) + number + '' : number;\nexport const padToTwo = number => number < 10 ? `0${number}`.slice(-2) : number;\nexport const getFormattedDate = (dt, sep) => padNum(1, dt.getDate(), 2) + sep + padNum(1, dt.getMonth(), 2) + sep + dt.getFullYear();\nexport const getFormattedTime = (dt, sep) => padNum(1, dt.getHours(), 2) + sep + padNum(1, dt.getMinutes(), 2);\nexport const securePwd = pwd => {\n  return bcrypt.hashSync(pwd, 8);\n};\nexport const comparePwd = (pwd, hash) => {\n  return bcrypt.compareSync(pwd, hash);\n};\nexport const parseRedisResponseToObj = str => {\n  //let s = str.replace(/[\\\\\"]/gi,'\"');\n  if (str) {\n    const regexp = /\\{.+\\}/mgi;\n    let arr = regexp.exec(str);\n\n    if (arr) {\n      return arr[0];\n    } //  const regexp1 = /\\\\\\\"/mgi;\n    //  n = arr[0].replace(regexp1, '\"');      \n\n  } //return \"\";\n\n\n  return {};\n}; // https://javascript.info/cookie. For more info on cookie apis\n\nexport const setCookie = (cname, cvalue, cookieopts) => {\n  let extensions = '';\n  let d = new Date();\n  let mxage = ';max-age=';\n  let expires = \";expires=\";\n  let ckpath = ';path=';\n\n  if (cookieopts && cookieopts.age) {\n    d.setTime(d.getTime() + cookieopts.age * 24 * 60 * 60 * 1000);\n  } else {\n    d.setTime(d.getTime() + 20000);\n  }\n\n  extensions = extensions + expires + d.toUTCString();\n\n  if (cookieopts && cookieopts['max-age']) {\n    extensions = extensions + mxage + cookieopts['max-age'];\n  }\n\n  if (cookieopts && cookieopts.path) {\n    extensions = extensions + ckpath + cookieopts.path;\n  }\n\n  console.log('cokkie string is: ' + cname + \"=\" + cvalue + extensions);\n  document.cookie = cname + \"=\" + cvalue + extensions;\n};\n/* export const getCookie = (cname)=> {\n    const name = cname + \"=\";\n    const decodedCookie = decodeURIComponent(document.cookie);\n    const ca = decodedCookie.split(';');\n    for(let i = 0; i <ca.length; i++) {\n      let c = ca[i];\n      while (c.charAt(0) == ' ') {\n        c = c.substring(1);\n      }\n      if (c.indexOf(name) == 0) {\n        return c.substring(name.length, c.length);\n      }\n    }\n    return \"\";\n  }\n */\n\nexport const getCookie = name => {\n  let matches = document.cookie.match(new RegExp(\"(?:^|; )\" + name.replace(/([\\.$?*|{}\\(\\)\\[\\]\\\\\\/\\+^])/g, '\\\\$1') + \"=([^;]*)\"));\n  return matches ? decodeURIComponent(matches[1]) : undefined;\n};\nexport const checkCookie = () => {\n  var sessid = getCookie(\"sessid\");\n\n  if (sessid != \"\") {\n    console.log(\"Welcome again \" + sessid);\n  } else {\n    console.log(\"Sessid id expired. Pls login again\");\n  }\n  /* else {\n    username = prompt(\"Please enter your name:\", \"\");\n    if (username != \"\" && username != null) {\n      setCookie(\"username\", username, 365);\n    }\n  } */\n\n};\nexport const deleteCookie = name => {\n  setCookie(name, \"\", {\n    'max-age': -1\n  });\n};\nexport const checkRunEnv = () => {\n  if (false) {\n    return 'client';\n  } else {\n    return 'server';\n  }\n};\nexport const processAccessToken = (location, ...rest) => {\n  let urlFragment = \"\";\n  const [label, data] = [...rest]; // console.log('Location: '+JSON.stringify(location));\n\n  if (location.hash.substring(1).length > 0) {\n    urlFragment = location.hash.substring(1); // console.log('location has a hash: '+ urlFragment);\n  } else if (location.search.substring(1).length > 0) {\n    urlFragment = location.search.substring(1); //  console.log('location has a s/arch: '+ urlFragment);\n  } //const urlFragment = location.search.substring(1);\n  //const urlFragment = location.hash.substring(1);\n  //console.log(\"URL Fragment: \"+ urlFragment);\n\n\n  const codeparams = {};\n  const regex = /([^&=]+)=([^&]*)/gm;\n  let m = 0;\n\n  if (data && label && label === 'googleToken') {\n    localStorage.setItem(label, JSON.stringify(data));\n  } else if (data) {\n    while (m = regex.exec(data)) {\n      codeparams[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);\n    } //  console.log('Twitter Code params: ' + JSON.stringify(codeparams));\n\n\n    localStorage.setItem(label, JSON.stringify(codeparams));\n  } else {\n    while (m = regex.exec(urlFragment)) {\n      codeparams[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);\n    } // console.log('Code params: ' + JSON.stringify(codeparams));\n\n\n    if (codeparams['access_token'] && typeof codeparams['access_token'] !== 'undefined' && codeparams['access_token'].length !== \"\") {\n      //  console.log('Access token: ' + JSON.stringify(codeparams));\n      localStorage.setItem(label, JSON.stringify(codeparams));\n    }\n  }\n  /* else if (codeparams['oauth_token'] &&\n    (typeof codeparams['oauth_token'] !== 'undefined') &&\n    codeparams['oauth_token'].length !== \"\") {\n    //  console.log('Access token: ' + JSON.stringify(codeparams));\n    localStorage.setItem(label, JSON.stringify(codeparams));\n  }*/\n\n};\nexport const getUid = () => {\n  return uuidv4();\n};","map":{"version":3,"sources":["/home/azure/spaces/reactapps/agt_basic/src/app/lib/utils.js"],"names":["bcrypt","v4","uuidv4","clipImage","w","h","imgsrc","sig","cnv","document","createElement","width","height","CNVASPECT","ctx","getContext","img","Image","src","Promise","resolve","reject","onload","sx","sy","dx","dy","iw","ih","cw","ch","IMGASPECT","drawImage","toDataURL","onerror","signal","addEventListener","event","Error","padNum","pad","number","numlength","length","Array","fill","padToTwo","slice","getFormattedDate","dt","sep","getDate","getMonth","getFullYear","getFormattedTime","getHours","getMinutes","securePwd","pwd","hashSync","comparePwd","hash","compareSync","parseRedisResponseToObj","str","regexp","arr","exec","setCookie","cname","cvalue","cookieopts","extensions","d","Date","mxage","expires","ckpath","age","setTime","getTime","toUTCString","path","console","log","cookie","getCookie","name","matches","match","RegExp","replace","decodeURIComponent","undefined","checkCookie","sessid","deleteCookie","checkRunEnv","processAccessToken","location","rest","urlFragment","label","data","substring","search","codeparams","regex","m","localStorage","setItem","JSON","stringify","getUid"],"mappings":"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","sourcesContent":["import bcrypt from 'bcryptjs';\nimport { v4 as uuidv4 } from 'uuid';\n\nexport const clipImage = (w, h, imgsrc, sig) => {\n\n  const cnv = document.createElement('canvas');\n\n  if (cnv !== null) {\n\n    cnv.width = w;\n    cnv.height = h;\n    const CNVASPECT = cnv.width / cnv.height;\n    const ctx = cnv.getContext('2d');\n    const img = new Image();\n    img.src = imgsrc;\n\n    return new Promise((resolve, reject) => {\n      img.onload = () => {\n        let sx = 0;\n        let sy = 0;\n        let dx = 0;\n        let dy = 0;\n        let iw = img.width;\n        let ih = img.height;\n        let cw = 0;\n        let ch = 0;\n\n        const IMGASPECT = iw / ih;\n\n\n        if (IMGASPECT >= CNVASPECT) {\n          //  console.log('Clipping sides : ' + IMGASPECT);\n          ch = cnv.height;\n          cw = IMGASPECT * ch;\n          dx = (cw - cnv.width) * 0.5;\n\n\n        } else {\n          //     console.log('Clipping height : ' + IMGASPECT);\n          cw = cnv.width;\n          ch = cw / IMGASPECT;\n\n          dy = (ch - cnv.height) * 0.5;\n\n        }\n        //  ctx.scale(2.0,2.0);\n        ctx.drawImage(img, sx, sy, iw, ih, -dx, -dy, cw, ch);\n        resolve(cnv.toDataURL('image/jpeg', 1.0));\n      }\n      img.onerror = () => {\n        if (sig.signal) {\n          sig.signal.addEventListener('abort', event => {\n            return reject(event);\n          });\n        }\n        return reject(new Error('I am an error'));\n      }\n\n\n    });\n  }\n}\n\n\nexport const padNum = (pad, number, numlength) => ((number + '').length < numlength) ? Array(pad).fill(0) + number + '' : number;\n\nexport const padToTwo = number => number < 10 ? `0${number}`.slice(-2) : number;\n\nexport const getFormattedDate = (dt, sep) => padNum(1, dt.getDate(), 2) + sep + padNum(1, dt.getMonth(), 2) + sep + dt.getFullYear();\n\nexport const getFormattedTime = (dt, sep) => padNum(1, dt.getHours(), 2) + sep + padNum(1, dt.getMinutes(), 2);\n\n\nexport const securePwd = (pwd) => {\n  return bcrypt.hashSync(pwd, 8);\n}\n\nexport const comparePwd = (pwd, hash) => {\n  return bcrypt.compareSync(pwd, hash);\n}\n\nexport const parseRedisResponseToObj = (str) => {\n  //let s = str.replace(/[\\\\\"]/gi,'\"');\n\n  if (str) {\n    const regexp = /\\{.+\\}/mgi;\n    let arr = regexp.exec(str);\n    if (arr) {\n      return arr[0];\n    }\n    //  const regexp1 = /\\\\\\\"/mgi;\n    //  n = arr[0].replace(regexp1, '\"');      \n\n  }\n\n\n  //return \"\";\n  return {};\n\n\n}\n\n\n// https://javascript.info/cookie. For more info on cookie apis\n\n\nexport const setCookie = (cname, cvalue, cookieopts) => {\n\n  let extensions = '';\n  let d = new Date();\n  let mxage = ';max-age=';\n  let expires = \";expires=\";\n  let ckpath = ';path=';\n\n\n  if (cookieopts && cookieopts.age) {\n    d.setTime(d.getTime() + (cookieopts.age * 24 * 60 * 60 * 1000));\n\n  } else {\n    d.setTime(d.getTime() + 20000);\n  }\n  extensions = extensions + expires + d.toUTCString();\n\n  if (cookieopts && cookieopts['max-age']) {\n    extensions = extensions + mxage + cookieopts['max-age'];\n  }\n\n\n  if (cookieopts && cookieopts.path) {\n    extensions = extensions + ckpath + cookieopts.path;\n  }\n\n\n\n  console.log('cokkie string is: ' + cname + \"=\" + cvalue + extensions)\n  document.cookie = cname + \"=\" + cvalue + extensions;\n\n}\n\n\n/* export const getCookie = (cname)=> {\n    const name = cname + \"=\";\n    const decodedCookie = decodeURIComponent(document.cookie);\n    const ca = decodedCookie.split(';');\n    for(let i = 0; i <ca.length; i++) {\n      let c = ca[i];\n      while (c.charAt(0) == ' ') {\n        c = c.substring(1);\n      }\n      if (c.indexOf(name) == 0) {\n        return c.substring(name.length, c.length);\n      }\n    }\n    return \"\";\n  }\n */\n\nexport const getCookie = (name) => {\n  let matches = document.cookie.match(new RegExp(\n    \"(?:^|; )\" + name.replace(/([\\.$?*|{}\\(\\)\\[\\]\\\\\\/\\+^])/g, '\\\\$1') + \"=([^;]*)\"\n  ));\n  return matches ? decodeURIComponent(matches[1]) : undefined;\n}\nexport const checkCookie = () => {\n  var sessid = getCookie(\"sessid\");\n  if (sessid != \"\") {\n    console.log(\"Welcome again \" + sessid);\n  } else {\n    console.log(\"Sessid id expired. Pls login again\");\n  } /* else {\n      username = prompt(\"Please enter your name:\", \"\");\n      if (username != \"\" && username != null) {\n        setCookie(\"username\", username, 365);\n      }\n    } */\n}\n\nexport const deleteCookie = (name) => {\n  setCookie(name, \"\", {\n    'max-age': -1\n  })\n}\n\nexport const checkRunEnv = () => {\n  if (typeof window !== 'undefined') {\n    return 'client'\n  } else {\n    return 'server';\n  }\n}\n\n\n\nexport const processAccessToken = (location, ...rest) => {\n\n  let urlFragment = \"\";\n  const [label, data] = [...rest];\n  // console.log('Location: '+JSON.stringify(location));\n\n  if (location.hash.substring(1).length > 0) {\n    urlFragment = location.hash.substring(1);\n    // console.log('location has a hash: '+ urlFragment);\n  } else if (location.search.substring(1).length > 0) {\n    urlFragment = location.search.substring(1);\n    //  console.log('location has a s/arch: '+ urlFragment);\n  }\n\n  //const urlFragment = location.search.substring(1);\n  //const urlFragment = location.hash.substring(1);\n\n  //console.log(\"URL Fragment: \"+ urlFragment);\n\n  const codeparams = {};\n  const regex = /([^&=]+)=([^&]*)/gm;\n  let m = 0;\n\n  if(data&&label&&label==='googleToken'){\n    localStorage.setItem(label, JSON.stringify(data));\n  }else if (data) {\n\n    while (m = regex.exec(data)) {\n      codeparams[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);\n    }\n //  console.log('Twitter Code params: ' + JSON.stringify(codeparams));\n    localStorage.setItem(label, JSON.stringify(codeparams));\n\n  } else {\n    while (m = regex.exec(urlFragment)) {\n      codeparams[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);\n    }\n\n   // console.log('Code params: ' + JSON.stringify(codeparams));\n\n    if (codeparams['access_token'] &&\n      (typeof codeparams['access_token'] !== 'undefined') &&\n      codeparams['access_token'].length !== \"\") {\n      //  console.log('Access token: ' + JSON.stringify(codeparams));\n      localStorage.setItem(label, JSON.stringify(codeparams));\n    }\n\n  }\n\n  /* else if (codeparams['oauth_token'] &&\n    (typeof codeparams['oauth_token'] !== 'undefined') &&\n    codeparams['oauth_token'].length !== \"\") {\n    //  console.log('Access token: ' + JSON.stringify(codeparams));\n    localStorage.setItem(label, JSON.stringify(codeparams));\n  }*/\n\n}\n\nexport const getUid = () => {\n\n\n  return uuidv4();\n\n\n}\n"]},"metadata":{},"sourceType":"module"}