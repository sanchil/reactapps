{"ast":null,"code":"import { session } from '../index'; //import uuidv4 from 'uuid/v4';\n\nimport { v4 as uuidv4 } from 'uuid'; //import * as blobUtil from 'blob-util';\n\nimport CONST from '../../consts';\nimport { parseRedisResponseToObj } from '../../lib/utils';\nexport const createSession = data => {\n  data.uid = data._id;\n  data._id = 'SESSION';\n  data.sessid = 'SESSION_' + uuidv4();\n  /* \n       return deleteSession()\n          .then(doc => doc)\n          .catch(err => {\n              console.log('deletion err:'+err.message)\n              return {};\n          })\n          .then(res => {\n              console.log(\"Session deletion :: adding a new session\" + JSON.stringify(res));\n              return session.put(data);\n          });\n   */\n};\nexport const getSession = () => {\n  return session.get('SESSION', {\n    latest: true,\n    conflicts: true\n  });\n};\nexport const deleteSession = () => {\n  return getSession().then(sess => {\n    console.log('getSession: found session: ' + JSON.stringify(sess));\n    return sess;\n  }).catch(err => {\n    console.log('getSession: session not found: ' + err.message);\n    return session.remove('SESSION', {\n      latest: true\n    });\n  });\n};\nexport const createRedisSession = (user, sessdata) => {\n  //   data.uid = data._id;\n  //   data._id = 'SESSION';\n  //   data.sessid = 'SESSION_' + uuidv4();\n  const sessid = 'SESSION_' + user._id;\n  const data = {};\n  data['sessdata'] = sessdata;\n  data['uid'] = user; // console.log('REDIS Session :: >> ' + JSON.stringify(data));\n  // # GET /set?key=one&val=first%20value\n  //# GET /get?key=some_key\n\n  const uri = CONST.SESSIONURL + '/set'; //  const req = new Request(uri);\n\n  const url = new URL(uri);\n  url.search = new URLSearchParams({\n    key: sessid,\n    val: `${JSON.stringify(data)}`\n  }).toString();\n  console.log('Session SET URL is: ' + JSON.stringify(url));\n  const req = new Request(url);\n  return fetch(req).then(res => {\n    console.log(\"FETCH SET response is : \" + res.status);\n\n    if (res.ok) {\n      return res.text();\n    } else {\n      console.log(\"FETCH SET response is not ok: \");\n      return {};\n    }\n  });\n};\nexport const getRedisSession = sessid => {\n  // const sessid = 'SESSION_' + docid;\n  const uri = CONST.SESSIONURL + '/get';\n  const url = new URL(uri);\n  url.search = new URLSearchParams({\n    key: sessid\n  });\n  const req = new Request(url);\n  console.log('Session GET URL is: ' + JSON.stringify(url));\n  return fetch(url).then(res => {\n    if (res.ok) {\n      console.log('REDIS GET response is:: ' + res.status);\n      return res.text();\n    } else {\n      console.log(\"FETCH GET response is not ok: \");\n      return {};\n    }\n  }).then(res => JSON.parse(parseRedisResponseToObj(res)));\n  /*   .then(res =>{\n      console.log(\"REis session object is __ 0 \"+ parseRedisResponseToObj(res));\n      JSON.parse(parseRedisResponseToObj(res))\n  } );  */\n};\nexport const deleteRedisSession = sessid => {\n  //   const sessid = 'SESSION_' + data._id;\n  const uri = CONST.SESSIONURL + '/del';\n  const url = new URL(uri);\n  url.search = new URLSearchParams({\n    key: sessid\n  }).toString();\n  const req = new Request(url);\n  return fetch(req).then(res => {\n    if (res.ok) {\n      console.log('REDIS DELETE response is:: ' + res.status);\n      return res.text();\n    } else {\n      return {};\n    }\n  }).then(res => res);\n};\nexport default {\n  getSession,\n  deleteSession,\n  createSession,\n  createRedisSession,\n  getRedisSession,\n  deleteRedisSession\n};","map":{"version":3,"sources":["/home/azure/spaces/reactapps/agt_basic/src/app/data/session/sessionquery.js"],"names":["session","v4","uuidv4","CONST","parseRedisResponseToObj","createSession","data","uid","_id","sessid","getSession","get","latest","conflicts","deleteSession","then","sess","console","log","JSON","stringify","catch","err","message","remove","createRedisSession","user","sessdata","uri","SESSIONURL","url","URL","search","URLSearchParams","key","val","toString","req","Request","fetch","res","status","ok","text","getRedisSession","parse","deleteRedisSession"],"mappings":"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","sourcesContent":["import { session } from '../index';\n//import uuidv4 from 'uuid/v4';\nimport { v4 as uuidv4 } from 'uuid';\n//import * as blobUtil from 'blob-util';\nimport CONST from '../../consts';\nimport { parseRedisResponseToObj } from '../../lib/utils';\n\nexport const createSession = (data) => {\n\n    data.uid = data._id;\n    data._id = 'SESSION';\n    data.sessid = 'SESSION_' + uuidv4();\n\n \n\n/* \n     return deleteSession()\n        .then(doc => doc)\n        .catch(err => {\n            console.log('deletion err:'+err.message)\n            return {};\n        })\n        .then(res => {\n            console.log(\"Session deletion :: adding a new session\" + JSON.stringify(res));\n            return session.put(data);\n        });\n */\n}\n\nexport const getSession = () => {\n    return session.get('SESSION', { latest: true , conflicts:true});\n}\n\nexport const deleteSession = () => {\n    return getSession()\n        .then(sess => {\n            console.log('getSession: found session: '+JSON.stringify(sess));\n            return sess;\n        })\n        .catch(err => {\n            console.log('getSession: session not found: ' + err.message)\n            return session.remove('SESSION', { latest: true });\n        })\n\n}\n\n\nexport const createRedisSession = (user, sessdata) => {\n\n    //   data.uid = data._id;\n    //   data._id = 'SESSION';\n    //   data.sessid = 'SESSION_' + uuidv4();\n\n    const sessid = 'SESSION_' + user._id;\n    const data = {};\n\n    data['sessdata'] = sessdata;\n    data['uid'] = user;\n    // console.log('REDIS Session :: >> ' + JSON.stringify(data));\n\n\n    // # GET /set?key=one&val=first%20value\n    //# GET /get?key=some_key\n\n    const uri = CONST.SESSIONURL + '/set';\n    //  const req = new Request(uri);\n    const url = new URL(uri);\n\n    url.search = new URLSearchParams({ key: sessid, val: `${JSON.stringify(data)}` }).toString();\n\n    console.log('Session SET URL is: ' + JSON.stringify(url));\n\n\n    const req = new Request(url);\n\n\n\n    return fetch(req)\n        .then(res => {\n            console.log(\"FETCH SET response is : \" + res.status);\n            if (res.ok) {\n                return res.text();\n            } else {\n                console.log(\"FETCH SET response is not ok: \");\n                return {}\n            }\n        })\n}\n\n\nexport const getRedisSession = (sessid) => {\n\n   // const sessid = 'SESSION_' + docid;\n\n    const uri = CONST.SESSIONURL + '/get';\n    const url = new URL(uri);\n    url.search = new URLSearchParams({ key: sessid });\n\n    const req = new Request(url);\n\n    console.log('Session GET URL is: ' + JSON.stringify(url));\n\n    return fetch(url)\n        .then(res => {\n            if (res.ok) {\n                console.log('REDIS GET response is:: ' + res.status);\n                return res.text();\n            } else {\n                console.log(\"FETCH GET response is not ok: \");\n                return {}\n            }\n        })\n        .then(res => JSON.parse(parseRedisResponseToObj(res)));\n        /*   .then(res =>{\n            console.log(\"REis session object is __ 0 \"+ parseRedisResponseToObj(res));\n            JSON.parse(parseRedisResponseToObj(res))\n    } );  */ \n       \n\n}\n\nexport const deleteRedisSession = (sessid) => {\n\n    //   const sessid = 'SESSION_' + data._id;\n\n    const uri = CONST.SESSIONURL + '/del';\n    const url = new URL(uri);\n    url.search = new URLSearchParams({ key: sessid }).toString();\n    const req = new Request(url);\n\n\n    return fetch(req)\n        .then(res => {\n\n            if (res.ok) {\n                console.log('REDIS DELETE response is:: ' + res.status);\n                return res.text();\n            } else {\n                return {}\n            }\n        })\n        .then(res => res);\n\n\n}\n\nexport default {\n    getSession,\n    deleteSession,\n    createSession,\n    createRedisSession,\n    getRedisSession,\n    deleteRedisSession\n}"]},"metadata":{},"sourceType":"module"}